#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include <math.h>

typedef int16_t i16;
typedef uint16_t u16;
typedef uint32_t u32;

typedef float f32;

void write16(FILE* f, u16 n) {
   fwrite(&n, sizeof(u16), 1, f);
}


void write32(FILE* f, u32 n) {
   fwrite(&n, sizeof(u32), 1, f);
}

#define WRITE_STR_LIT(f, s) fwrite((s), 1, sizeof(s) - 1, f)
#define FREQ 44100

int main(void) {
   FILE* f = fopen("track10.wav", "wb");

struct {
   f32 freq;
   f32 dur;
} notes[] = {
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 262, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 220, 60.0f / (100 * 4)},

   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 262, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 220, 60.0f / (100 * 4)},

   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 262, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 220, 60.0f / (100 * 4)},

   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 49, 60.0f / (100 * 4)},
   { 117, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 55, 60.0f / (100 * 4)},
   { 131, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 58, 60.0f / (100 * 4)},
   { 147, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 262, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 165, 60.0f / (100 * 4)},
   { 175, 60.0f / (100 * 4)},
   { 65, 60.0f / (100 * 4)},
   { 220, 60.0f / (100 * 4)},
};

u32 numNotes = sizeof(notes) / sizeof(notes[0]);

f32 duration = 0.0f;
for (u32 i = 0; i < numNotes; i++) {
   duration += notes[i].dur;
}

   u32 numSamples = (u32) (duration * FREQ);
   u32 fileSize = numSamples * sizeof(u16) + 44;

   WRITE_STR_LIT(f, "RIFF");
   write32(f, fileSize - 8);
   WRITE_STR_LIT(f, "WAVE");
  
   WRITE_STR_LIT(f, "fmt ");
   write32(f, 16);
   write16(f, 1);
   write16(f, 1);
   write32(f, FREQ);
   write32(f, FREQ * sizeof(u16));
   write16(f, sizeof(u16));
   write16(f, sizeof(u16) * 8);

   WRITE_STR_LIT(f, "data");
   write32(f, numSamples * sizeof(u16));

   u32 currNote = 0;
   f32 currNoteStart = 0.0f;
   for (u32 i = 0; i < numSamples; i++) {
      f32 t = (f32)i / FREQ;

      f32 y = 0.0f;

      if (currNote < numNotes) {
         /* y = 0.25f * sinf(t * notes[currNote].freq * 2.0f * 3.1415926535f); */
         y = 0.25f * fmod(t * notes[currNote].freq, 1.0f);

            if (t > currNoteStart + notes[currNote].dur){
               currNote++;
               currNoteStart = t;
            }
      }
      i16 sample = (i16)(y * INT16_MAX);

      write16(f, sample);
   }

   fclose(f);

   return 0;
}
